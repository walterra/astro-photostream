---
/**
 * Individual photo page - consolidated route using shared utilities
 * Handles URLs: /photos/2018-03-10_elasticon-0001, etc.
 */
import { config } from 'virtual:astro-photostream/config';
import PhotoDetailContent from '../../components/PhotoDetailContent.astro';
import SeoHead from '../../components/SeoHead.astro';
import { generatePhotoDetailPaths } from '../../utils/pagination.js';
import { convertToPhotoMetadata } from '../../utils/photo-data.js';
import { generatePhotoDetailSeo } from '../../utils/seo.js';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths: GetStaticPaths = async () => {
  return await generatePhotoDetailPaths();
};

// Get props from static generation
const { photo, prevPhoto, nextPhoto, photoIndex, totalPhotos } = Astro.props;

// Convert to PhotoMetadata format
const photoData = convertToPhotoMetadata(photo);


// Generate SEO metadata
const seoData = generatePhotoDetailSeo(
  photoData,
  photoIndex,
  totalPhotos,
  config.seo,
  Astro.url
);
---

<html lang="en">
  <head>
    <SeoHead 
      title={seoData.title}
      description={seoData.description}
      canonical={seoData.canonical}
      ogImageUrl={seoData.ogImageUrl}
      jsonLd={seoData.jsonLd}
      siteName={config.seo.siteName}
    />
    
    <!-- Navigation hints for preloading -->
    {prevPhoto && <link rel="prefetch" href={`/photos/${prevPhoto.slug}`} />}
    {nextPhoto && <link rel="prefetch" href={`/photos/${nextPhoto.slug}`} />}
  </head>
  
  <body>
    <main class="aps-container">
      <PhotoDetailContent 
        photo={photo}
        photoData={photoData}
        prevPhoto={prevPhoto}
        nextPhoto={nextPhoto}
        photoIndex={photoIndex}
        totalPhotos={totalPhotos}
        config={config}
      />
    </main>
  </body>
</html>